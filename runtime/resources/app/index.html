<!DOCTYPE html>
<html>

	  <link href="build/nv.d3.css" rel="stylesheet" type="text/css">
    <script src="d3.min.js" charset="utf-8"></script>
    <script src="build/nv.d3.js"></script>
    <link rel="stylesheet" href="dist/css/photon.css">
    <style>
        text {
            font: 12px sans-serif;
        }
        svg {
            display: block;
        }
        html, body, #chart1, svg {
            margin: 0px;
            padding: 0px;
            height: 95%;
            width: 87%;
        }
        #chartZoom {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>

 <body> 
<style type="text/css">
body {
background-color: WindowFrame;
overflow:hidden;
-webkit-user-select: none;
}
</style>
<div class="window">
<header class="toolbar toolbar-header">


			<div id="menu" width="130%">	
Start &lambda;:<input type="text" size="5" value="1300.00" id="start">nm Stop &lambda;:<input type="text" value="1700.00" size="5" id="stop">nm Res: <select id="res">
  <option value="0.07">0.07 nm</option>
  <option value="0.1">0.1 nm</option>
  <option value="0.2">0.2 nm</option>
  <option value="0.5">0.5 nm</option>
  <option value="1.0">1.0 nm</option>
</select> Averages:<input type="text" id="avarages" size="2" value="0">S Points:<select id="samplingpoints">
  <option value="51">51</option>
  <option value="101">101</option>
  <option value="251">251</option>
  <option value="501">501</option>
  <option value="1001">1001</option>
  <option value="2001">2001</option>
  <option value="5001">5001</option>
</select>Interval:<input type="text" id="continuous-time-interval" size="2" value="0">s<input type="checkbox" id="cnt" onchange="check1()">Continuous<input type="button" id="run" value="Run" onclick="analisaespectro()"><input type="text" id="boxcar" style="visibility:hidden" size="1" value="0"><select id="boxcar2" style="visibility:hidden">
  <option value="OFF">0</option>
  <option value="3">3</option>
  <option value="5">5</option>
  <option value="7">7</option>
  <option value="9">9</option>
  <option value="11">11</option>
</select>
</div>
</header>
</header>
  <div class="window-content">
    <div class="pane-group">
      <div class="pane" style="overflow:hidden">
	
	<div id="hddhh" class='with-transitions' width="130%" height="90%" left="20%">
	<div id="chart1" class='with-transitions' style="background-color:white;margin: 0 auto;">
    <svg></svg>
 </div>
  </div>
  </div>
</div>
</div>
<footer class="toolbar toolbar-footer"><div id="uighygig">Device:<input type="text" id="device" size="20" value="/dev/osaUSB">
</div>
<div id="ugiyghi">
Status:Waiting for user input...
</div>
<div id="progress">

</div>

</footer>
</body>

</div>

<script type="text/javascript">
//modo de aquisição continuo
var Config = require('electron-config');
var config = new Config();
var comprimentodeondainicioultimaaquisicaogfhgfh=config.get("STA");
var comprimentodeondafinalultimaaquisicaogfhgfh=config.get("STO");
var numerodepontosultimaaquisicaogfhgfh=config.get("Spoints");



var fs = require('fs');
var dados=[];
var realizandoaquisicao=0;
var tempoultimamedida=0;
var tempoatualaaa=0;
var terminougravacaonomodocontinuo=1;
var contadorarquivogravacao=0;
var gravacaomodocontinuo=0;//Grava ou não o arquivo no modo continuo.
var localsalvararquivomodocontinuo="";//Local onde gravar os espectros no modo continuo.
var comecounovociclocontinuo=0;//depois que atualizar o grafico passa isto para zero.
var codigoarquivob="";
var fftyftytbb=Number(numerodepontosultimaaquisicaogfhgfh)-1;
var estavarealizandoaquisicaonomodocontinuo=0;
function verificamodocontinuohabilitado(){
if(document.getElementById("cnt").checked+""=="false"){
contadorarquivogravacao=0;
}
if(document.getElementById("cnt").checked+""=="true"){
//console.log("ok1");
if(realizandoaquisicao+""=="0"){
if(terminougravacaonomodocontinuo+""=="1"){
//console.log("ok2");
if(comecounovociclocontinuo+""=="0"){
//console.log("ok3");
tempoatualaaa=Date.now();
//console.log("tempoultimamedida:"+tempoultimamedida+"   Tempoatual:"+tempoatualaaa+"   Diferenca:"+(-Number(tempoultimamedida)+Number(tempoatualaaa))+"   Limiar:"+(Number(document.getElementById("continuous-time-interval").value)*1000));
if((-Number(tempoultimamedida)+Number(tempoatualaaa))>(Number(document.getElementById("continuous-time-interval").value)*1000)){
comecounovociclocontinuo=1;
terminougravacaonomodocontinuo=0;
estavarealizandoaquisicaonomodocontinuo=1;
analisaespectro();
tempoultimamedida=Date.now();
}
}
}
}
}
if(realizandoaquisicao+""=="0"){
if(comecounovociclocontinuo+""=="0"){
if(estavarealizandoaquisicaonomodocontinuo+""=="1"){
if(gravacaomodocontinuo+""=="1"){
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//Grava arquivo em localsalvararquivomodocontinuo+"."+contadorarquivogravacao.
codigoarquivob="";
fftyftytbb=Number(numerodepontosultimaaquisicaogfhgfh)-1;
        for (var i = 0; i <= fftyftytbb; i++) {
         codigoarquivob=codigoarquivob+""+(((Number(comprimentodeondafinalultimaaquisicaogfhgfh)-Number(comprimentodeondainicioultimaaquisicaogfhgfh))*(i)/fftyftytbb)+Number(comprimentodeondainicioultimaaquisicaogfhgfh))+"\t"+ dados[i]+"\r\n";
        }

fs.writeFile(""+localsalvararquivomodocontinuo+"."+contadorarquivogravacao+"", ""+codigoarquivob+"", function(err) {
    if(err) {
dialog.showMessageBox({ message: "Error when saving the file.",buttons: ["OK"], type:"error", title:"Error" });
    }else{
if(localsalvararquivomodocontinuo+""!="undefined"){
}else{
dialog.showMessageBox({ message: "File save canceled.",buttons: ["OK"], type:"warning", title:"Warning" });
}
}
}); 
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------------------------
contadorarquivogravacao=contadorarquivogravacao+1;
}
estavarealizandoaquisicaonomodocontinuo=0;
terminougravacaonomodocontinuo=1;
}
}
}
}
setInterval("verificamodocontinuohabilitado()",50);// A aquisição deve sempre demorar menos que este valor.



//fim
const {dialog} = require('electron').remote;
document.getElementById("device").disabled = true;

var deviceok=0;
//document.getElementById("device").value=config.get("device");
if(config.get("STA")+""!="undefined"){
document.getElementById("start").value=config.get("STA");
}
var configabcsta=document.getElementById("start").value;
if(config.get("STO")+""!="undefined"){
document.getElementById("stop").value=config.get("STO");
}
var configabcsto=document.getElementById("stop").value;
if(config.get("RES")+""!="undefined"){
document.getElementById("res").value=config.get("RES");
}
var configabcres=document.getElementById("res").value;
if(config.get("AVG")+""!="undefined"){
document.getElementById("avarages").value=config.get("AVG");
}
var configabcavg=document.getElementById("avarages").value;
if(config.get("Spoints")+""!="undefined"){
document.getElementById("samplingpoints").value=config.get("Spoints");
}
var configabcSpoints=document.getElementById("samplingpoints").value;
if(config.get("interval")+""!="undefined"){
document.getElementById("continuous-time-interval").value=config.get("interval");
}
var configabcinterval=document.getElementById("continuous-time-interval").value;
//Checagem dos parametros
var outraaquisicao=0;
function check1(){
if(configabcsta+""!=document.getElementById("start").value+""){
config.set("STA",""+document.getElementById("start").value);
configabcsta=document.getElementById("start").value;
console.log("s");
}
if(configabcsto+""!=document.getElementById("stop").value+""){
config.set("STO",""+document.getElementById("stop").value);
configabcsto=document.getElementById("stop").value;
console.log("s");
}
if(configabcres+""!=document.getElementById("res").value+""){
config.set("RES",""+document.getElementById("res").value);
configabcres=document.getElementById("res").value;
console.log("s");
}
if(configabcavg+""!=document.getElementById("avarages").value+""){
config.set("AVG",""+document.getElementById("avarages").value);
configabcavg=document.getElementById("avarages").value;
console.log("s");
}
if(configabcSpoints+""!=document.getElementById("samplingpoints").value+""){
config.set("Spoints",""+document.getElementById("samplingpoints").value);
configabcSpoints=document.getElementById("samplingpoints").value;
console.log("s");
}
if(configabcinterval+""!=document.getElementById("continuous-time-interval").value+""){
config.set("interval",""+document.getElementById("continuous-time-interval").value);
configabcinterval=document.getElementById("continuous-time-interval").value;
console.log("s");
}


if(document.getElementById("cnt").checked+""=="true"){
document.getElementById("run").disabled = true;
document.getElementById("start").disabled = true;
document.getElementById("stop").disabled = true;
document.getElementById("boxcar").disabled = true;
document.getElementById("boxcar2").disabled = true;
document.getElementById("avarages").disabled = true;
document.getElementById("res").disabled = true;
document.getElementById("continuous-time-interval").disabled = true;
document.getElementById("samplingpoints").disabled = true;
document.getElementById("device").disabled = true;
if(document.getElementById("avarages").value+""==""){
document.getElementById("avarages").value=0;
}
if(document.getElementById("boxcar").value+""==""){
document.getElementById("boxcar").value=0;
}
if(document.getElementById("start").value+""==""){
document.getElementById("start").value="1300.00";
}
if(document.getElementById("stop").value+""==""){
document.getElementById("stop").value="1700.00";
}
}else{
if(outraaquisicao+""=="0"){
document.getElementById("run").disabled = false;
document.getElementById("start").disabled = false;
document.getElementById("stop").disabled = false;
document.getElementById("boxcar").disabled = false;
document.getElementById("boxcar2").disabled = false;
document.getElementById("avarages").disabled = false;
document.getElementById("continuous-time-interval").disabled = false;
document.getElementById("res").disabled = false;
document.getElementById("device").disabled = true;
document.getElementById("samplingpoints").disabled = false;
}
}

}
setInterval("check1()",50);
var gigyugy=0;
var nmediasaaa="OFF";
function check2(){
if(document.getElementById("avarages").value+""=="0"){
nmediasaaa="OFF";
}else{
nmediasaaa=document.getElementById("avarages").value;
}
if(document.getElementById("device").value+""!="null"){
deviceok=1;
}
if(deviceok+""=="1"){
config.set("device", ""+document.getElementById("device").value);
if(gigyugy+""=="0"){
gigyugy=1;
var childhtreht = exec(`python ${__dirname}/verificadispositivo.py `+document.getElementById("device").value+"",function(err, stdout, stderr) {
    if(err) {
//dialog.showMessageBox({ message: "Error when opening the device. Try again in a few seconds. If the problem continues check the device port on the textbox below the graph.",buttons: ["OK"], type:"error", title:"Error" });
document.getElementById("cnt").checked=false;   
} 
});
}
}
if(document.getElementById("avarages").value+""!=(document.getElementById("avarages").value).replace(/\D/g,'')+""){
document.getElementById("avarages").value=(document.getElementById("avarages").value).replace(/\D/g,'');
}
if(document.getElementById("boxcar").value+""!=(document.getElementById("boxcar").value).replace(/\D/g,'')+""){
document.getElementById("boxcar").value=(document.getElementById("boxcar").value).replace(/\D/g,'');
}
if(document.getElementById("start").value+""!=(document.getElementById("start").value).replace(/[^\d.-]/g, '')+""){
document.getElementById("start").value=(document.getElementById("start").value).replace(/[^\d.-]/g, '');
}
if(document.getElementById("continuous-time-interval").value+""!=(document.getElementById("continuous-time-interval").value).replace(/[^\d.-]/g, '')+""){
document.getElementById("continuous-time-interval").value=(document.getElementById("continuous-time-interval").value).replace(/[^\d.-]/g, '');
}
if(document.getElementById("stop").value+""!=(document.getElementById("stop").value).replace(/[^\d.-]/g, '')+""){
document.getElementById("stop").value=(document.getElementById("stop").value).replace(/[^\d.-]/g, '');
}
}
setInterval("check2()",50);
//Fim da checagem dos parametros

//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
const {remote} = require('electron')
const {Menu, MenuItem} = remote
const menuTemplate = [
    {
        label: 'File',
        submenu: [
            {
                label: 'Save Spectrum',
                click: () => {
                    saveonefile();
                }
            }, {
                label: 'Quit',
                click: () => {
window.close();
                }
            }
        ]
    },{
 label: 'Help',
        submenu: [
            {
                label: 'Help',
                click: () => {
dialog.showMessageBox({ message: " Start: Start wavelength (minimun wavelength is 600 nm)\n\n Stop: Stop wavelength (maximum wavelength is 1750 nm)\n\n Res: Set the slit opening correspondent to this maximum spectrum resolution (actual resolution also depends on \"S points\" parameter).\n\n Averages: Number of averages on each spectrum wavelength.\n\n S Points: Number of points on the spectrum. \n\n Interval: Interval to wait between measurements (only works if \"Continuous\" checkbox is checked).\n\n Continuous: Check this to enable continuous mode. \n\n Run: Run one measurement.\n\n  File-->save spectrum: Saves last spectrum measured or if continuous mode is enabled save all new spectra measured until \"Continuous\" checkbox is disabled.",buttons: ["OK"], type:"info", title:"Help" });
                }
            }, {
                label: 'About',
                click: () => {
dialog.showMessageBox({ message: "Program developed by Luis Victor Muller Fabris.",buttons: ["OK"], type:"info", title:"About" });
                }
            }
        ]
}
];
const menu = Menu.buildFromTemplate(menuTemplate);
Menu.setApplicationMenu(menu);
const spawn = require('child_process').spawn;
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//-------------------------------------------------------
//inicio da função analisaespectro()
function analisaespectro(){
if(document.getElementById("avarages").value+""==""){
document.getElementById("avarages").value=0;
}
if(document.getElementById("avarages").value+""=="1"){
document.getElementById("avarages").value=2;
}
if(Number(document.getElementById("avarages").value)>1000){
document.getElementById("avarages").value=1000;
}
if(document.getElementById("boxcar").value+""==""){
document.getElementById("boxcar").value=0;
}

if(document.getElementById("start").value+""==""){
document.getElementById("start").value="1300.00";
}
if(document.getElementById("stop").value+""==""){
document.getElementById("stop").value="1700.00";
}

if(Number(document.getElementById("start").value)<600){
document.getElementById("start").value="600.00";
}
if(Number(document.getElementById("stop").value)>1750){
document.getElementById("stop").value="1750.00";
}


if(Number(document.getElementById("stop").value)<Number(document.getElementById("start").value)){
document.getElementById("start").value="600.00";
document.getElementById("stop").value="1750.00";
}


check2();
check1()
//if(document.getElementById("cnt").checked+""=="false"){
outraaquisicao=1;
document.getElementById("run").disabled = true;
document.getElementById("start").disabled = true;
document.getElementById("stop").disabled = true;
document.getElementById("boxcar").disabled = true;
document.getElementById("boxcar2").disabled = true;
document.getElementById("continuous-time-interval").disabled = true;
document.getElementById("avarages").disabled = true;
document.getElementById("res").disabled = true;
//document.getElementById("cnt").disabled = true;
document.getElementById("device").disabled = true;
document.getElementById("samplingpoints").disabled = true;
realizandoaquisicao=1;
document.getElementById("ugiyghi").innerHTML="Status:Measuring...";
document.getElementById("progress").innerHTML="<progress id='progress1' value='0' max='100'></progress>";
carregaespectro();
//}
}
//fim da função analisaespectro()
var timerfimaquisicao=0;
var comandob="";
var permiteaquisicaomudancafaixa=0;
var child="";
var exec = require('child_process').execFile;
function carregaespectro(){
console.log("Aquisição iniciada.");






child = exec("python",[`${__dirname}/serialcom.py`,""+document.getElementById("samplingpoints").value+"",""+document.getElementById("res").value+"",""+document.getElementById("device").value+"",""+nmediasaaa+"",""+document.getElementById("boxcar2").value+"",""+document.getElementById("start").value+"",""+document.getElementById("stop").value+""],function(err, stdout, stderr) {
console.log(stdout);
permiteaquisicaomudancafaixa=1;
if(err){
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
//colocado depois para corrigir o bug do modo continuo
estavarealizandoaquisicaonomodocontinuo=0;
terminougravacaonomodocontinuo=1;
realizandoaquisicao=0;
comecounovociclocontinuo=0;
//colocado depois para corrigir o bug do modo continuo
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
//---------------------------------------------------------------------------------------------------
dialog.showMessageBox({ message: "Error when opening the device. Try again in a few seconds. If the problem continues check the device port on the textbox below the graph.",buttons: ["OK"], type:"error", title:"Error" });
realizandoaquisicao=0;
document.getElementById("cnt").checked=false;
outraaquisicao=0;
document.getElementById("cnt").disabled = false;
document.getElementById("ugiyghi").innerHTML="Status:Waiting for user input...";
document.getElementById("progress").innerHTML="";
}
});
}
//comandob.stdout.on('data', (data) => {
//console.log(data.toString());
//});





var comandoc="";
var childb="";
function verificafimaquisicao(){
if(realizandoaquisicao+""=="1"){
//console.log("Verificando fim aquisição.");


childb = exec("python",[`${__dirname}/verificafimaquisicao.py`,""+document.getElementById("device").value+""],function(err, stdout, stderr) {

    if(err) {
//console.log("Erro abertura OSA.");
//dialog.showMessageBox({ message: "Error on opening device but the device was open. Program will quit.",buttons: ["OK"], type:"error", title:"Error" });
//window.close();
   } else {    
//console.log("Resultado:"+stdout+"");
        if(Number(stdout)+""=="1"){
timerfimaquisicao=0;
}
        if(Number(stdout)+""=="0"){
if(permiteaquisicaomudancafaixa+""=="1"){
timerfimaquisicao=timerfimaquisicao+1;
if(timerfimaquisicao>2){
timerfimaquisicao=0;
realizandoaquisicao=0;
//console.log(stdout);
recebeespectro();   
permiteaquisicaomudancafaixa=0;
}
}
    }
}
});

}
}

setInterval("verificafimaquisicao()",1000);

var childc="";
var hdffhddhfdfhhdfhdh="";
function recebeespectro(){

document.getElementById("progress").innerHTML="<progress id='progress1' value='0' max='100'></progress>";


document.getElementById("ugiyghi").innerHTML="Status:Downloading data...";
childc = exec("python",[`${__dirname}/serialcom-2.py`,""+document.getElementById("samplingpoints").value+"",""+document.getElementById("device").value+""],function(err, stdout, stderr) {
if(err){document.getElementById("cnt").checked=false;}
var stringauxiliar=stdout;
while(stringauxiliar.indexOf("E")+""!="-1"){
stringauxiliar=stringauxiliar.replace("E","e");
}
dados=stringauxiliar.split("\n");
var hgugyy=0;
while(dados[hgugyy]+""!=""){
dados[hgugyy]=Number(dados[hgugyy]);
//console.log(dados[hgugyy]);
hgugyy=hgugyy+1;
}
//console.log(dados);
desenhagrafico(920*4);
outraaquisicao=0;
document.getElementById("ugiyghi").innerHTML="Status:Waiting for user input...";
hdffhddhfdfhhdfhdh="";
document.getElementById("progress").innerHTML="";
document.getElementById("run").disabled = false;
document.getElementById("start").disabled = false;
document.getElementById("stop").disabled = false;
document.getElementById("boxcar").disabled = false;
document.getElementById("continuous-time-interval").disabled = false;
document.getElementById("boxcar2").disabled = false;
document.getElementById("avarages").disabled = false;
document.getElementById("res").disabled = false;
document.getElementById("device").disabled = true;
document.getElementById("cnt").disabled = false;
});
childc.stdout.on('data', function(data) {
    hdffhddhfdfhhdfhdh=hdffhddhfdfhhdfhdh+data;
document.getElementById("progress").innerHTML="<progress id='progress1' value='"+((Number(hdffhddhfdfhhdfhdh.split("\n").length)/Number(document.getElementById("samplingpoints").value))*100)+"' max='100'></progress>";

});

}

var contador=0;
//while(contador<920*4){
while(contador<5002){
dados[contador]=(0);
contador=contador+1;
}
desenhagrafico(document.getElementById("stop").value);



        var chart = nv.models.lineChart();

function desenhagrafico(valormaximox){


comprimentodeondainicioultimaaquisicaogfhgfh=document.getElementById("start").value;
comprimentodeondafinalultimaaquisicaogfhgfh=document.getElementById("stop").value;
numerodepontosultimaaquisicaogfhgfh=document.getElementById("samplingpoints").value;



document.getElementById("chart1").innerHTML="<svg></svg>";
    nv.addGraph(function() {

        var fitScreen = true;
        var width = 600;
        var height = 300;
        var zoom = 1.5;

        chart.useInteractiveGuideline(false);
        chart.xAxis
            .tickFormat(d3.format(',r'));

        chart.lines.dispatch.on("elementClick", function(evt) {
            console.log(evt);
        });
function desenhagfef(){
        chart.yAxis
            .axisLabel('Intensity')
            .tickFormat(d3.format(',.4s'));
      chart.xAxis
            .axisLabel('Wavelength (nm)')
            .tickFormat(d3.format(',.3f'));

        d3.select('#chart1 svg')
            .attr('perserveAspectRatio', 'xMinYMid')
            .attr('width', width)
            .attr('height', height)
            .datum(sinAndCos());

        setChartViewBox();
        resizeChart();

        nv.utils.windowResize(resizeChart);
}
desenhagfef();


        function setChartViewBox() {
            var w = width * zoom,
                h = height * zoom;

            chart
                .width(w)
                .height(h);

            d3.select('#chart1 svg')
                .attr('viewBox', '0 0 ' + w + ' ' + h)
                .transition().duration(500)
                .call(chart);
        }

        function zoomOut() {
            zoom += .25;
            setChartViewBox();
        }

        function zoomIn() {
            if (zoom <= .5) return;
            zoom -= .25;
            setChartViewBox();
        }

        // This resize simply sets the SVG's dimensions, without a need to recall the chart code
        // Resizing because of the viewbox and perserveAspectRatio settings
        // This scales the interior of the chart unlike the above
        function resizeChart() {
            var container = d3.select('#chart1');
            var svg = container.select('svg');

            if (fitScreen) {
                // resize based on container's width AND HEIGHT
                var windowSize = nv.utils.windowSize();
                svg.attr("width", windowSize.width);
                svg.attr("height", windowSize.height);
            } else {
                // resize based on container's width
                var aspect = chart.width() / chart.height();
                var targetWidth = parseInt(container.style('width'));
                svg.attr("width", targetWidth);
                svg.attr("height", Math.round(targetWidth / aspect));
            }
        }
        return chart;
    });

    function sinAndCos() {
        var sin = [],
            cos = [];
var fftyftyt=Number(document.getElementById("samplingpoints").value)-1;
        for (var i = 0; i <= fftyftyt; i++) {
            //sin.push({x: i, y: Math.sin(i/10) });
           sin.push({x: (((Number(document.getElementById("stop").value)-Number(document.getElementById("start").value))*(i)/fftyftyt)+Number(document.getElementById("start").value)), y: dados[i]*1 });
//console.log(fftyftyt);
        }

        return [
            {
                values: sin,
                key: "",
                color: "#ff7f0e"
            },
          
        ];

    }
comecounovociclocontinuo=0;
}

function saveonefile(){
var localarquivoasalvar="";
if(document.getElementById("cnt").checked+""=="true"){
dialog.showMessageBox({ message: "Continuous capture mode is enabled, multiple files will be saved until this mode is disabled.",buttons: ["OK"], type:"info", title:"Warning" });
localsalvararquivomodocontinuo=""+dialog.showOpenDialog({properties: ['openFile']});
gravacaomodocontinuo=1;
}else{
localarquivoasalvar=dialog.showSaveDialog();
var codigoarquivo="";
var fftyftytb=Number(numerodepontosultimaaquisicaogfhgfh)-1;
        for (var i = 0; i <= fftyftytb; i++) {
         codigoarquivo=codigoarquivo+""+(((Number(comprimentodeondafinalultimaaquisicaogfhgfh)-Number(comprimentodeondainicioultimaaquisicaogfhgfh))*(i)/fftyftytb)+Number(comprimentodeondainicioultimaaquisicaogfhgfh))+"\t"+ dados[i]+"\r\n";
        }

fs.writeFile(""+localarquivoasalvar+"", ""+codigoarquivo+"", function(err) {
    if(err) {
dialog.showMessageBox({ message: "Error when saving the file.",buttons: ["OK"], type:"error", title:"Error" });
    }else{
if(localarquivoasalvar+""!="undefined"){
dialog.showMessageBox({ message: "The file was saved.",buttons: ["OK"], type:"info", title:"File saved" });
}else{
dialog.showMessageBox({ message: "File save canceled.",buttons: ["OK"], type:"warning", title:"Warning" });
}
}
}); 

}
}


window.onbeforeunload = function (e) { 
child.kill();
childb.kill();
childc.kill();
};

</script>
</body>
</html>
